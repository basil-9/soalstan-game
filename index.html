<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø²Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        
        :root {
            --primary: #2B2D42;
            --secondary: #8D99AE;
            --accent: #EF233C;
            --text: #EDF2F4;
            --success: #2ecc71;
            --danger: #e74c3c;
            --gold: #f1c40f;
        }

        * {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: var(--primary);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }

        h1 {
            color: var(--gold);
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        input, select, button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: none;
            font-size: 1.1rem;
            outline: none;
        }

        input, select {
            background: rgba(255,255,255,0.9);
            color: var(--primary);
        }

        button {
            background: var(--accent);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(239, 35, 60, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .header-stats {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .team-a { color: #3498db; }
        .team-b { color: #e67e22; }

        .hint-box {
            background: var(--gold);
            color: var(--primary);
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 900;
            margin: 20px 0;
        }

        .question-box {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5rem;
            line-height: 1.6;
        }

        .question-image {
            max-width: 100%;
            max-height: 350px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: none; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ ÙˆØªØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØµÙˆØ± */
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1px;
            gap: 15px;
            margin-top: 20px;
        }

        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
        }

        .option-btn {
            background: var(--secondary);
            font-size: 1.2rem;
            padding: 20px;
            box-shadow: none;
        }

        .option-btn:hover { background: #7f8c8d; }
        
        .correct-answer {
            background-color: var(--success) !important;
            color: white !important;
        }

        .wrong-answer {
            background-color: var(--danger) !important;
            color: white !important;
        }

        .timer {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--gold);
            margin: 15px 0;
        }

        #bid-section { display: none; }
        #question-section { display: none; }
        
        .hidden { display: none !important; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø¹Ø´Ø§Ù† ØªÙƒÙˆÙ† Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ */
        .leader-panel {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>

    <audio id="sound-correct" src="https://www.myinstants.com/media/sounds/correct-sound-effect.mp3"></audio>
    <audio id="sound-wrong" src="https://www.myinstants.com/media/sounds/wrong-buzzer.mp3"></audio>

    <div class="container" id="login-screen">
        <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø²Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ ğŸ¯</h1>
        <input type="text" id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" required>
        <input type="text" id="roomID" placeholder="Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©" required>
        <select id="teamSelect">
            <option value="A">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚ (A)</option>
            <option value="B">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ (B)</option>
        </select>
        <button onclick="joinGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    </div>

    <div class="container" id="game-screen" class="hidden">
        <div class="header-stats">
            <div class="team-a">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚: <span id="scoreA">100</span></div>
            <div id="roundInfo">Ø§Ù„Ø¬ÙˆÙ„Ø©: <span id="roundNum">0</span></div>
            <div class="team-b">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ: <span id="scoreB">100</span></div>
        </div>

        <div id="leaderControls" class="leader-panel hidden">
            <button onclick="startNextRound()" style="background: var(--success);">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</button>
            <button onclick="changeQuestion()" style="background: var(--secondary);">ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„ (Ù†ÙØ³ Ø§Ù„Ø¬ÙˆÙ„Ø©)</button>
        </div>

        <div id="bid-section">
            <div class="hint-box" id="hintText">...</div>
            <h3 id="currentBidder">Ø§Ù„Ù…Ø²Ø§Ø¯ Ù…ÙØªÙˆØ­...</h3>
            <input type="number" id="bidAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø©">
            <button onclick="placeBid()">Ù…Ø²Ø§ÙŠØ¯Ø©</button>
            <button onclick="passAuction()" style="background: var(--secondary);">Ø§Ù†Ø³Ø­Ø§Ø¨ (Pass)</button>
        </div>

        <div id="question-section">
            <div class="timer" id="timerDisplay">30</div>
            <div class="question-box">
                <div id="questionText">...</div>
                <img id="questionImage" class="question-image" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„">
            </div>
            <div class="options-grid" id="optionsContainer"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myTeam = '';
        let myName = '';
        let isLeader = false;
        let currentQ = null;
        let countdown;
        let roundSettings = { roundTime: 30 };

        function playSound(type) {
            const audio = document.getElementById(type === 'correct' ? 'sound-correct' : 'sound-wrong');
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Ø§Ù„ØµÙˆØª Ù…Ù‚ÙÙ„ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­"));
            }
        }

        function joinGame() {
            myName = document.getElementById('playerName').value;
            const roomID = document.getElementById('roomID').value;
            myTeam = document.getElementById('teamSelect').value;

            if(!myName || !roomID) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù…Ø² Ø§Ù„ØºØ±ÙØ©');

            socket.emit('joinRoom', { roomID, team: myTeam });
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
        }

        socket.on('init', (data) => {
            document.getElementById('scoreA').innerText = data.pointsA;
            document.getElementById('scoreB').innerText = data.pointsB;
            isLeader = data.isLeader;
            roundSettings = data.settings;
            if(isLeader) document.getElementById('leaderControls').classList.remove('hidden');
        });

        function startNextRound() {
            socket.emit('requestAuction');
        }

        function changeQuestion() {
            socket.emit('changeQuestion');
        }

        socket.on('startAuction', (data) => {
            document.getElementById('leaderControls').classList.add('hidden');
            document.getElementById('question-section').style.display = 'none';
            document.getElementById('bid-section').style.display = 'block';
            
            document.getElementById('roundNum').innerText = data.roundNumber;
            document.getElementById('hintText').innerText = "ØªÙ„Ù…ÙŠØ­: " + data.hint;
            document.getElementById('currentBidder').innerText = "Ø§Ù„Ù…Ø²Ø§Ø¯ Ù…ÙØªÙˆØ­...";
            document.getElementById('bidAmount').value = '';
            
            currentQ = data.fullQuestion;
        });

        function placeBid() {
            const amount = document.getElementById('bidAmount').value;
            if(amount) socket.emit('placeBid', { team: myTeam, name: myName, amount });
        }

        function passAuction() {
            socket.emit('winAuction', { team: myTeam === 'A' ? 'B' : 'A' });
        }

        socket.on('updateBid', (data) => {
            document.getElementById('currentBidder').innerText = `Ø£Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ¯Ø©: ${data.amount} Ù…Ù† ${data.name} (${data.team})`;
        });

        socket.on('revealQuestion', (winnerData) => {
            document.getElementById('bid-section').style.display = 'none';
            document.getElementById('question-section').style.display = 'block';
            
            document.getElementById('questionText').innerText = currentQ.q;
            
            // Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙˆØ±: ÙŠÙ‚Ø±Ø£ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ† (image Ø£Ùˆ img) Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØ®Ø±Ø¨ Ø¹Ù„ÙŠÙƒ Ø£ÙŠ Ø³Ø¤Ø§Ù„
            const imgElement = document.getElementById('questionImage');
            const imgSrc = currentQ.image || currentQ.img; 
            if (imgSrc) {
                imgElement.src = imgSrc;
                imgElement.style.display = 'block';
            } else {
                imgElement.style.display = 'none';
                imgElement.src = '';
            }

            renderOptions(currentQ.options, winnerData.team === myTeam);
            startTimer();
        });

        function renderOptions(options, isMyTurn) {
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                if(isMyTurn) {
                    btn.onclick = () => submitAnswer(opt, btn);
                } else {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
                container.appendChild(btn);
            });
        }

        function startTimer() {
            clearInterval(countdown);
            let timeLeft = roundSettings.roundTime;
            document.getElementById('timerDisplay').innerText = timeLeft;
            countdown = setInterval(() => {
                timeLeft--;
                document.getElementById('timerDisplay').innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(countdown);
                    submitAnswer("TIMEOUT", null);
                }
            }, 1000);
        }

        function submitAnswer(ans, btnElement) {
            clearInterval(countdown);
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.disabled = true);

            if(btnElement && ans !== "TIMEOUT") {
                btnElement.style.border = "3px solid white";
            }

            socket.emit('submitAnswer', { answer: ans, team: myTeam, name: myName });
        }

        // Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª: ØªØ±Ø¬Ø¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØªÙ†ØªÙ‚Ù„ Ù„Ù„Ø®ØµÙ… Ù…Ø¹ Ø®ØµÙ… Ù†Ù‚Ø§Ø·
        socket.on('timeOutPass', (data) => {
            clearInterval(countdown);
            playSound('wrong');
            document.getElementById('scoreA').innerText = data.toTeam === 'B' ? data.points : document.getElementById('scoreA').innerText;
            document.getElementById('scoreB').innerText = data.toTeam === 'A' ? data.points : document.getElementById('scoreB').innerText;
            
            setTimeout(() => {
                alert(`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! â³\nØ§Ù„Ø³Ø¤Ø§Ù„ ÙŠÙ†ØªÙ‚Ù„ Ù„Ù„ÙØ±ÙŠÙ‚ ${data.toTeam} Ù…Ø¹ Ø­Ø°Ù Ø®ÙŠØ§Ø±`);
                renderOptions(data.newOptions, data.toTeam === myTeam);
                startTimer();
            }, 500);
        });

        socket.on('passTurn', (data) => {
            clearInterval(countdown);
            playSound('wrong'); 
            
            document.getElementById('scoreA').innerText = data.toTeam === 'B' ? data.points : document.getElementById('scoreA').innerText;
            document.getElementById('scoreB').innerText = data.toTeam === 'A' ? data.points : document.getElementById('scoreB').innerText;
            
            alert(`Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠÙ†ØªÙ‚Ù„ Ù„Ù„ÙØ±ÙŠÙ‚ ${data.toTeam} Ù…Ø¹ Ø­Ø°Ù Ø®ÙŠØ§Ø± ÙˆØ§Ø­Ø¯`);
            renderOptions(data.newOptions, data.toTeam === myTeam);
            startTimer();
        });

        socket.on('roundResult', (data) => {
            clearInterval(countdown);
            playSound(data.isCorrect ? 'correct' : 'wrong');

            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(btn => {
                if (btn.innerText === data.correctAns) {
                    btn.classList.add('correct-answer');
                } else {
                    btn.classList.add('wrong-answer');
                }
            });

            document.getElementById('scoreA').innerText = data.team === 'A' ? data.points : document.getElementById('scoreA').innerText;
            document.getElementById('scoreB').innerText = data.team === 'B' ? data.points : document.getElementById('scoreB').innerText;
            
            setTimeout(() => {
                if(data.isTimeout) {
                    alert(`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ âŒ\nØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${data.correctAns}`);
                } else {
                    alert(`${data.name} Ø¬Ø§Ø¨Ù‡Ø§ ${data.isCorrect ? 'ØµØ­ âœ…' : 'ØºÙ„Ø· âŒ'}! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡ÙŠ: ${data.correctAns}`);
                }
                if(isLeader) document.getElementById('leaderControls').classList.remove('hidden');
            }, 2000);
        });

        socket.on('gameOver', (scores) => {
            let winner = scores.pointsA > scores.pointsB ? "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚ ğŸ†" : (scores.pointsB > scores.pointsA ? "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ğŸ†" : "ØªØ¹Ø§Ø¯Ù„ ğŸ¤");
            alert(`Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!\nØ§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:\nØ§Ù„Ø£Ø²Ø±Ù‚: ${scores.pointsA}\nØ§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ: ${scores.pointsB}\nØ§Ù„ÙØ§Ø¦Ø²: ${winner}`);
        });
    </script>
</body>
</html>




















